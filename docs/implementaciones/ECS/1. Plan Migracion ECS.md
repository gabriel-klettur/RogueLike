Plan de alto nivel para migrar tu módulo de NPC a un esquema ECS:

1. Definir la arquitectura ECS
- Vamos a utilizar la libreria 'esper' para los NPCS e Items.
- Establece las tres piezas clave:
    - Entity Manager: crea/borra entidades (IDs).
    - Componentes: datos puros (sin lógica).
    - Sistemas: procesan componentes por tipo cada frame.

2. Inventario de datos y comportamientos actuales
- Piensa y elabora qué atributos y métodos usan los NPC (posición, sprite, estado de salud, IA, pathfinding, colisiones…).

3. Diseñar los componentes
Por ejemplo:

-   PositionComponent { x, y }
-   SpriteComponent { image, z_layer }
-   MovementComponent { speed, target }
-   CollisionComponent { solid, bounds }
-   AIComponent { state_machine, params }
-   HealthComponent { hp, max_hp }
-   LootComponent, DialogueComponent, etc.

4. Implementar el Entity Manager / World
-   Crea/modifica un gestor que:
    - Asigne IDs (enteros) a las entidades.
    - Permita agregar/quitar componentes a cada ID.
    - Expose métodos get_entities_with(ComponentA, ComponentB…).

5. Desarrollar sistemas básicos
-   MovementSystem: lee Position+Movement y actualiza coordenadas.
-   AISystem: lee AIComponent y escribe en MovementComponent o dispara eventos.
-   RenderSystem: lee Position+Sprite y hace blit en pantalla.
-   CollisionSystem: chequeos contra CollisionComponent.
-   HealthSystem, LootSystem, …
Cada sistema recibe el mundo y ejecuta su lógica en ciclo de juego.

6. Crea un NPC completo, que sea un enemigo y que spawnee en las zonas de la dungeon. Este NPC debe tener todos los componentes necesarios para que funcione correctamente. Los assets de este primer NPC seran los que estan en 'assets/npc/monsters/barbol' ahi estan los 4 assets a los que puede mirar el NPC.

7. Ajustar bucle de juego
- En Game.run() o en tu update_manager, sustituye las llamadas directas de NPC por:
world.process_systems(dt)
world.render_systems(screen, camera)

8. Pruebas y validación
- Crea tests unitarios para cada sistema (e.g. que MovementSystem mueva correctamente).
Testea casos de IA, colisión y render.

9. Optimización y limpieza
- Si es necesario, añade consultas de entidades “por grupo” o filtros para mejorar rendimiento.
- Elimina código obsoleto (classes NPC, controladores mezclados).

10. Documentación
- Actualiza tu doc Collisiones para buildings.md o crea ECS.md explicando:
- Cómo crear entidades y sistemas.
Patrón de uso en el motor.